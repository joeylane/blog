<!doctype html><!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]--><!--[if IE 7]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if IE 8]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class=no-js><!--<![endif]--><head><meta charset=utf-8><title>Pwning Bulldog 2 (Walkthrough) &#183; ./own.sh</title><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="In this article we will be doing a walkthrough of a really awesome vulnerable VM called Bulldog 2."><meta name=keywords content="bulldog 2,vulnerable vm,vulnhub,"><meta property="og:title" content="Pwning Bulldog 2 (Walkthrough)  &#183; ./own.sh"><meta property="og:site_name" content="./own.sh"><meta property="og:url" content="https://blog.own.sh/pwning-bulldog-2-walkthrough/"><meta property="og:locale" content="en-EN"><meta property="og:type" content="article"><meta property="og:description" content="In this article we will be doing a walkthrough of a really awesome vulnerable VM called Bulldog 2."><meta property="og:image" content="https://blog.own.sh/img/pwning-bulldog-2-walkthrough/bulldog2.png"><meta property="og:article:published_time" content="2018-09-23T23:34:57-05:00"><meta property="og:article:modified_time" content="2018-09-23T23:34:57-05:00"><meta property="og:article:tag" content="bulldog 2"><meta property="og:article:tag" content="vulnerable vm"><meta property="og:article:tag" content="vulnhub"><meta name=twitter:card content="summary"><meta name=twitter:site content="@j0eylane"><meta name=twitter:creator content="@j0eylane"><meta name=twitter:title content="Pwning Bulldog 2 (Walkthrough)"><meta name=twitter:description content="In this article we will be doing a walkthrough of a really awesome vulnerable VM called Bulldog 2."><meta name=twitter:image content="https://blog.own.sh/img/pwning-bulldog-2-walkthrough/bulldog2.png"><meta name=twitter:url content="https://blog.own.sh/pwning-bulldog-2-walkthrough/"><meta name=twitter:domain content="https://blog.own.sh"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.own.sh\/pwning-bulldog-2-walkthrough\/"},"headline":"Pwning Bulldog 2 (Walkthrough)","author":{"@type":"Person","name":"Joey Lane"},"publisher":{"@type":"Organization","name":"blog.own.sh","logo":{"@type":"ImageObject","url":"https://blog.own.sh/apple-touch-icon.png"}},"image":"https:\/\/blog.own.sh\/img\/pwning-bulldog-2-walkthrough\/bulldog2.png","datePublished":"2018-09-23","dateModified":"2018-09-23","description":"In this article we will be doing a walkthrough of a really awesome vulnerable VM called Bulldog 2.","wordCount":2106}</script><link rel=canonical href=https://blog.own.sh/pwning-bulldog-2-walkthrough/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><!--[if lt IE 9]><script src=https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js></script><script src=https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js></script><![endif]--><link href="https://fonts.googleapis.com/css?family=Merriweather:300%7CRaleway%7COpen+Sans" rel=stylesheet type=text/css><link rel=stylesheet href=/css/font-awesome.min.css><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/highlight/tomorrow-night.css></head><body><main id=main-wrapper class="container main_wrapper has-sidebar"><header id=main-header class="container main_header"><div class="container brand"><div class="container title h1-like"><a class=baselink href=https://blog.own.sh>./own.sh</a></div><div class="container topline">Penetration testing, bug bounty, and ethical hacking.</div></div><nav class="container nav primary no-print"><a class=homelink href=https://blog.own.sh>Home</a>
<a href=https://blog.own.sh/about>About Author</a>
<a href=https://blog.own.sh/tags>Tags</a>
<a href=https://blog.own.sh/pgp>PGP</a></nav><div class="container nav secondary no-print" style=font-size:2em><a id=contact-link-email class=contact_link href=mailto:blog@own.sh><span class="fa fa-envelope-square"></span><span>email</span></a>
<a id=contact-link-github class=contact_link href=https://github.com/joeylane target=_blank><span class="fa fa-github-square"></span><span>github</span></a>
<a id=contact-link-linkedin class=contact_link href=https://www.linkedin.com/in/joeylane84 target=_blank><span class="fa fa-linkedin-square"></span><span>linkedin</span></a>
<a id=contact-link-twitter class=contact_link href=https://twitter.com/j0eylane target=_blank><span class="fa fa-twitter-square"></span><span>twitter</span></a></div></header><article id=main-content class="container main_content single"><header class="container hat"><h1>Pwning Bulldog 2 (Walkthrough)</h1><div class=metas><time datetime=2018-09-23>Sep 23, 2018</time>
by Joey Lane<br>Tags:
<a class=label href=https://blog.own.sh/tags/vulnerable-vm>Vulnerable VM</a> /
<a class=label href=https://blog.own.sh/tags/web-application-hacking>Web Application Hacking</a> /</div></header><div class="container content"><p>In this article we will be doing a walkthrough of a really awesome vulnerable VM called Bulldog 2. This was a really fun and challenging boot-to-root VM for a number of reasons. The author <a href=https://twitter.com/@frichette_n>Nick Frichette</a> (who is also a co-worker of mine) built the vulnerable application using AngularJS, which gave the VM a much more modern feel than some of the more typical PHP focused vulnerable VMs. I admittedly did not have much experience with AngularJS going into this, so I can honestly say I learned quite a bit. Hopefully you&rsquo;ll find this walkthrough helpful.</p><h2 id=assumptions>Assumptions</h2><p>Before reading any further, it is important to point out that I am making a few assumptions about why you are reading this article:</p><ul><li>I assume that you have already downloaded and launched the Bulldog 2 VM. If not, you can acquire the VM <a href=https://www.vulnhub.com/entry/bulldog-2,246/>here</a>. I will not be covering how to setup the VM in your virtualization platform (VMWare, VirtualBox, etc).</li><li>I assume that you are going to be attacking this VM using the Kali Linux distribution.</li><li>I assume that since you are here, you understand that this article contains spoilers on how to complete the challenge and obtain the flag.</li></ul><h2 id=bulldog-2-back-story>Bulldog 2 back story</h2><p>Three years have passed since Bulldog Industries suffered severe data breaches. In that time, they have recovered and re-branded as Bulldog.social, an up and coming social media company. Can you take on this new challenge and get root on their production web server?</p><h2 id=enumeration>Enumeration</h2><p>We initially know nothing about this machine, so we will start off by enumerating the target for any potentially vulnerable services. Begin by running nmap against the machine to see what services are listening:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>nmap -p- -sT -Pn 192.168.56.101
</code></pre></div><p>As we can see by the results of our scan, there is not a large attack surface in regards to running services. The only port listening for connections is port 80, which indicates a web application is likely running. Lets open it in a browser and take a look.</p><p>nmap results:
<img src=/img/pwning-bulldog-2-walkthrough/nmap.png alt="alt text" title="Bulldog 2 - nmap"></p><p>Bulldog.social web application running on HTTP port 80:
<img src=/img/pwning-bulldog-2-walkthrough/bulldog2.png alt="alt text" title="Bulldog 2 - web application"></p><p>If we navigate the links available to us in the application, the login page appears to be the most logical page to attack. Unfortunately we do not have any credentials to log in with. If we inspect the site using our Javascript debugger, it becomes apparent that the application was built with AngularJS. We also discover a few interesting routes within the &lsquo;main.js&rsquo; file of the application. The route &lsquo;/users/getUsers&rsquo; seems particularly interesting, so lets take a look at it by navigating to it manually in our browser:</p><p><img src=/img/pwning-bulldog-2-walkthrough/getusers.png alt="alt text" title="Bulldog 2 - json dump of all users"></p><p>As you can see, this endpoint returns some very interesting information to us. It returns a JSON response which contains 3 pieces of information for each user on the system:</p><ol><li>name</li><li>username</li><li>rand</li></ol><p>At this point, we have a way to obtain a list of usernames that could potentially be used to log into the system. To make things a little easier, we are going to grab the usernames from this endpoint and dump them into a text file. We are not interested in the &lsquo;name&rsquo; or &lsquo;rand&rsquo; values, so they will be discarded. We need to get each username, and write it to the text file one username per line. There are a number of ways this can be done, I chose to write a simple python script to do it for me that I&rsquo;ll just call &lsquo;enum.py&rsquo;:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>nano enum.py
</code></pre></div><p>Paste the following code into the text editor, make sure to edit the IP address in the &lsquo;url&rsquo; variable to match your local Bulldog 2 VM:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> urllib2 <span style=color:#f92672>import</span> urlopen
<span style=color:#f92672>import</span> json

url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://192.168.56.101/users/getUsers?limit=&#39;</span>
response <span style=color:#f92672>=</span> urlopen(url)
json_obj <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>load(response)

<span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> json_obj:
    <span style=color:#66d9ef>print</span> i[<span style=color:#e6db74>&#39;username&#39;</span>]
</code></pre></div><p>Now we can run our script which will result in the usernames being placed neatly into a text file called &lsquo;usernames.txt&rsquo;:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>python enum.py &gt; usernames.txt
</code></pre></div><p>Now that we have a list of users, we will use a web application fuzzer called &lsquo;wfuzz&rsquo; to attempt a dictionary attack against the passwords. With any luck this may find a user in our list who is using a weak password. We are going to use a list of common passwords to attempt the dictionary attack against the login form by running the following command. Make sure to adjust the URL to match the IP of your Bulldog 2 VM:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>wfuzz -w usernames.txt -w /usr/share/wfuzz/wordlist/others/common_pass.txt -H &#34;Content-Type: application/json&#34; -H &#34;Referer: http://192.168.56.101/login&#34; -d &#34;{\&#34;username\&#34;:\&#34;FUZZ\&#34;, \&#34;password\&#34;: \&#34;FUZ2Z\&#34;}&#34; -t 20 --hc 401 http://192.168.56.101/users/authenticate
</code></pre></div><p><img src=/img/pwning-bulldog-2-walkthrough/wfuzz.png alt="alt text" title="Bulldog 2 - bruteforce logins"></p><p>Looks like we got lucky! The user &lsquo;mdrudie&rsquo; appears to be using the password &lsquo;qwerty&rsquo;. We could let this scan continue and probably find additional users, but for now lets stop and see what we can do with the &lsquo;mdrudie&rsquo; account. Go back to the login page and login with our new credentials:</p><p><img src=/img/pwning-bulldog-2-walkthrough/login.png alt="alt text" title="Bulldog 2 - login"></p><p>Login was successful:
<img src=/img/pwning-bulldog-2-walkthrough/loginsuccess.png alt="alt text" title="Bulldog 2 - login successful"></p><h2 id=finding-a-vulnerability>Finding a vulnerability</h2><p>So we&rsquo;ve logged into the application with credentials we discovered during the enumeration phase of our penetration test. Unfortunately for us, this user does not appear to have any interesting privileges on the application. Our next step will be to identify any possible ways that we could manipulate our authorization. If we open the developer tools in our browser and take a look at the local storage, we can see an interesting key called &lsquo;user&rsquo;. This key appears to contain some values which are relevant to our current user such as name and email address. We also notice a value called &lsquo;auth_level&rsquo;, which is currently set to &lsquo;standard_user&rsquo;:</p><p><img src=/img/pwning-bulldog-2-walkthrough/localstorage.png alt="alt text" title="Bulldog 2 - local storage"></p><p>This is very suspicious, it appears that the client side of the application may be handling the authorization level of the user. After further examination of the &lsquo;main.js&rsquo; file in our Javascript debugger, we notice the presence of an authorization level in the code called &lsquo;master_admin_user&rsquo;. Lets see what happens if we modify the &lsquo;user&rsquo; key in our browsers local storage, and replace the &lsquo;auth_level&rsquo; value with &lsquo;master_admin_user&rsquo;:</p><p><img src=/img/pwning-bulldog-2-walkthrough/localstorage-modified.png alt="alt text" title="Bulldog 2 - local storage modified"></p><p>Refresh the page:
<img src=/img/pwning-bulldog-2-walkthrough/localstorage-admin.png alt="alt text" title="Bulldog 2 - local storage admin"></p><p>After refreshing the page, we can now see a new link on the top menu called &lsquo;Admin&rsquo;. It looks like we have discovered an authorization vulnerability. If we take a look at the &lsquo;Admin&rsquo; page we&rsquo;ll notice a new login form. Unfortunately the credentials we discovered earlier do not seem to work here:</p><p><img src=/img/pwning-bulldog-2-walkthrough/admin-wrongpwd.png alt="alt text" title="Bulldog 2 - admin wrong password"></p><p>Lets look a little bit closer at the new login form and see if there is anything we can tamper with. We&rsquo;ll use Burp Suite to simplify the process for us. First we will need to change our proxy settings in Firefox so that all of our traffic gets routed through Burp:</p><p><img src=/img/pwning-bulldog-2-walkthrough/proxy.png alt="alt text" title="Bulldog 2 - burp proxy settings"></p><p>Once we&rsquo;ve set up our proxy, lets try logging in again. This time we will catch the HTTP request in Burp so that we can replay it and tamper with it. We see that attempting to log in makes a POST request to an endpoint called &lsquo;/users/linkauthenticate&rsquo;. The request appears to contain the username and password we submitted when attempting to log in. Lets send that request to the Repeater tab in Burp so that we can play with it:</p><p><img src=/img/pwning-bulldog-2-walkthrough/burp-post.png alt="alt text" title="Bulldog 2 - burp post"></p><p>Our previous request is now available in Repeater:
<img src=/img/pwning-bulldog-2-walkthrough/burp-repeater.png alt="alt text" title="Bulldog 2 - burp repeater"></p><p>If we attempt to inject a double quote character (") at the beginning of the password and resend it, we will notice that the application throws a verbose syntax error message:</p><p><img src=/img/pwning-bulldog-2-walkthrough/burp-repeater-error.png alt="alt text" title="Bulldog 2 - burp repeater error"></p><p>This indicates that the form may be vulnerable to command injection. Lets attempt to inject the Linux &lsquo;ls&rsquo; command and see what happens:</p><p><img src=/img/pwning-bulldog-2-walkthrough/burp-repeater-cmd-injection-fail.png alt="alt text" title="Bulldog 2 - burp repeater command injection fail"></p><p>We can see that our request did NOT return an error this time, yet we can&rsquo;t be certain that our command was executed because no output was echoed back to the browser. In situations like this, we can attempt to confirm command injection by telling the vulnerable server to interact with the machine we are attacking from. The easiest way to do this is by injecting a simple &lsquo;ping&rsquo; command, and listening for the pings on the local machine we are attacking from. If we receive the pings on our attacking machine, we know the victim is executing the commands we inject. Lets attempt to inject a ping command into the password field. We will start Wireshark on our Kali Linux machine to listen for the pings. Remember you will need to replace the IP address we are pinging with the IP address of your local Kali Linux machine:</p><p><img src=/img/pwning-bulldog-2-walkthrough/burp-repeater-cmd-injection-ping.png alt="alt text" title="Bulldog 2 - burp repeater command injection ping"></p><p><img src=/img/pwning-bulldog-2-walkthrough/pings.png alt="alt text" title="Bulldog 2 - pings"></p><p>As you can see, our local Kali Linux machine received the pings from the victim server. This indicates we have a confirmed command injection vulnerability.</p><h2 id=exploiting-the-vulnerability>Exploiting the vulnerability</h2><p>We now know that we can execute commands on the remote server, but we need to find a way to leverage this to obtain an interactive shell. A shell will enable us to further explore the system. We will attempt to leverage existing tools on the vulnerable machine to download and execute a malicious payload which we will host on our Kali Linux machine. Lets start off by generating a Meterpreter reverse shell payload with Metasploit:</p><p><img src=/img/pwning-bulldog-2-walkthrough/msfvenom.png alt="alt text" title="Bulldog 2 - msfvenom"></p><p>We can serve our Meterpreter payload to the victim by using a web server. Python includes a module called &lsquo;SimpleHTTPServer&rsquo; which makes this very easy to do:</p><p><img src=/img/pwning-bulldog-2-walkthrough/pythonwebserver.png alt="alt text" title="Bulldog 2 - python web server"></p><p>Lets go back to Burp, and use Repeater once again to inject a command into the password field. This time we will inject a &lsquo;wget&rsquo; command, and tell the victim to download our Meterpreter payload from our Python webserver:</p><p><img src=/img/pwning-bulldog-2-walkthrough/burp-repeater-cmd-injection-wget.png alt="alt text" title="Bulldog 2 - burp repeater command injection wget"></p><p>We will need to give the Meterpreter payload executable permissions before we can run it. Once again we will use Repeater, but this time we will use it to add executable permissions to our payload by injecting the &lsquo;chmod&rsquo; command:</p><p><img src=/img/pwning-bulldog-2-walkthrough/burp-repeater-cmd-injection-chmod.png alt="alt text" title="Bulldog 2 - burp repeater command injection chmod"></p><p>We are almost ready to execute our payload now, but first we need to setup a listener on our local Kali Linux machine to catch the reverse shell. We will use the &lsquo;exploit/multi/handler&rsquo; module in the Metasploit framework to do this. Start the Metasploit console by using the following command:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>msfconsole
</code></pre></div><p>Now type the following commands into msfconsle to configure our listener. Replace the &lsquo;LHOST&rsquo; IP address with the IP of your local Kali Linux machine:</p><p><img src=/img/pwning-bulldog-2-walkthrough/msfconsole.png alt="alt text" title="Bulldog 2 - msfconsole"></p><p>Now we can go back to Burp and leverage Repeater once again to inject a command. This time we will execute the Meterpreter shell we sent to the victim, and catch it in our msfconsole:</p><p><img src=/img/pwning-bulldog-2-walkthrough/burp-repeater-cmd-injection-execute.png alt="alt text" title="Bulldog 2 - burp repeater command injection execute"></p><p>As we can see, we have caught our Meterpreter shell, and we can now interact directly with the operating system:</p><p><img src=/img/pwning-bulldog-2-walkthrough/meterpreter.png alt="alt text" title="Bulldog 2 - meterpreter"></p><h2 id=privilege-escalation>Privilege escalation</h2><p>We now have a solid foothold on the server, but we are not finished yet. Lets see if we can identify a privilege escalation vulnerability to elevate our OS privileges to root. This will give us complete control over the system. A quick look at the &lsquo;/etc&rsquo; directory reveals something very odd. The &lsquo;/etc/passwd&rsquo; file appears to allow ALL users on the system to modify it:</p><p><img src=/img/pwning-bulldog-2-walkthrough/passwd-permissions.png alt="alt text" title="Bulldog 2 - /etc/passwd permissions"></p><p>We can modify this file to change the password of the root user by using the &lsquo;edit&rsquo; command in Meterpreter. We will then drop into a bash shell and leverage the &lsquo;su&rsquo; command to become the root user. Notice the highlighted &lsquo;x&rsquo; character in the screenshot below on the very first line. This &lsquo;x&rsquo; tells the OS to look for the password for the root user in the file &lsquo;/etc/shadow&rsquo;. We do not have permission to modify that file, however we do not need it. For backward compatibility reasons, some linux distributions will first look for a hash in the &lsquo;/etc/passwd&rsquo; file if the &lsquo;x&rsquo; is not present. We simply need to replace &lsquo;x&rsquo;, with a hashed password:</p><p><img src=/img/pwning-bulldog-2-walkthrough/originalpw.png alt="alt text" title="Bulldog 2 - original password"></p><p>We can generate a password hash on our local Kali Linux machine by using perl. In the example below, we are generating a hash for the password &lsquo;hacked&rsquo;:</p><p><img src=/img/pwning-bulldog-2-walkthrough/generate-passwd.png alt="alt text" title="Bulldog 2 - generate password"></p><p>Now simply replace the &lsquo;x&rsquo; next to the root user with the hash we generated:</p><p><img src=/img/pwning-bulldog-2-walkthrough/changepw.png alt="alt text" title="Bulldog 2 - change password"></p><p>After saving the file, we then execute the &lsquo;shell&rsquo; command from our Meterpreter session. This will drop us into an interactive bash shell on the system. Next we will spawn a TTY using python, and then run the &lsquo;su&rsquo; command. This will prompt us for the password of the root user. Type in &lsquo;hacked&rsquo; as our password, and you can see that we have now become the root user. You can view the flag by typing &lsquo;cat flag.txt&rsquo;:</p><p><img src=/img/pwning-bulldog-2-walkthrough/flag.png alt="alt text" title="Bulldog 2 - flag"></p><h2 id=conclusion>Conclusion</h2><p>Special thanks to <a href=https://twitter.com/@frichette_n>Nick Frichette</a> for building such an awesome vulnerable VM. Follow him on Twitter and while you&rsquo;re at it, follow <a href=https://twitter.com/@j0eylane>me</a> too! I hope you found this walkthrough enjoyable. Feel free to post comments below!</p><h4 id=i-hope-you-enjoyed-reading-this>I hope you enjoyed reading this!</h4><p>Please feel free to connect with me on social media, it&rsquo;s always great to collaborate with other infosec professionals! If you found this information useful, I would greatly appreciate skill endorsements on <a href=https://www.linkedin.com/in/joeylane84/>LinkedIn</a>!</p></div><footer class=container><div class="container navigation no-print"><h2>Navigation</h2><a class=next href=https://blog.own.sh/introduction-to-network-protocol-fuzzing-buffer-overflow-exploitation/ title="Introduction to Network Protocol Fuzzing & Buffer Overflow Exploitation">Next</a></div><div class="container comments"><h2>Comments</h2><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")
return;var dsq=document.createElement('script');dsq.async=true;dsq.type='text/javascript';dsq.src='//own-sh.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></footer></article><footer id=main-footer class="container main_footer"><div class="container nav foot no-print"><a class=toplink href=#>back to top</a></div><div class="container credits"><div class="container footline"></div><div class="container copyright">(c) 2018 Joey Lane.</div></div></footer></main><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>